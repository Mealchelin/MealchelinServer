<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
	
<mapper namespace="com.mealchelin.mvc.product.model.mapper.ProductMapper">
	<sql id="selectProductSql">
		SELECT PRD_NO,
			   NAME,
			   CATEGORY,
			   PRICE,
			   PRD_DESC,
			   IMAGE,
			   BRAND,
			   DISPLAY,
			   SALE,
			   STOCK,
			   RGSTR_DATE,
			   TOTAL_SALES,
			   VIEWS,
			   RATING,
			   STATUS,
			   WEIGHT
		FROM PRODUCT
		WHERE STATUS = 'Y' AND DISPLAY = 'Y'
	</sql>
	
	<resultMap id="productResultMap" type="Product">
		<id property="no" column="PRD_NO"/>
		<result property="name" column="NAME"/>
		<result property="category" column="CATEGORY"/>
		<result property="price" column="PRICE"/>
		<result property="description" column="PRD_DESC"/>
		<result property="image" column="IMAGE"/>
		<result property="brand" column="BRAND"/>
		<result property="sale" column="SALE"/>
		<result property="stock" column="STOCK"/>
		<result property="rgstrDate" column="RGSTR_DATE"/>
		<result property="totalSales" column="TOTAL_SALES"/>
		<result property="views" column="VIEWS"/>
		<result property="rating" column="RATING"/>
		<result property="status" column="STATUS"/>
		<result property="weight" column="WEIGHT"/>
	</resultMap>

	<select id="selectProductCount" resultType="_int">
		SELECT COUNT(*) FROM PRODUCT
	</select>
	
	<select id="selectProductCountByCategory" resultType="_int" parameterType="string">
		SELECT COUNT(*) FROM PRODUCT WHERE CATEGORY = #{category}
	</select>
	
	<select id="selectProductList" resultMap="productResultMap">
		<include refid="selectProductSql"/>
		ORDER BY TOTAL_SALES DESC
	</select>
	
	<select id="selectProductListBySort" resultMap="productResultMap">
		<include refid="selectProductSql"/>
		ORDER BY 
		<choose>
			<when test="sort == 'lowest'">
				PRICE ASC
			</when>
			<when test="sort == 'highest'">
				PRICE DESC
			</when>
			<otherwise>
				TOTAL_SALES DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="selectProductListByCategory" resultMap="productResultMap">
		<include refid="selectProductSql"/>
		AND CATEGORY = #{category}
		ORDER BY TOTAL_SALES DESC
	</select>
	
	<select id="selectProductListByCategoryAndSort" resultMap="productResultMap">
		<include refid="selectProductSql"/>
		AND CATEGORY = #{category}
		ORDER BY 
		<choose>
			<when test="sort == 'lowest'">
				PRICE ASC
			</when>
			<when test="sort == 'highest'">
				PRICE DESC
			</when>
			<otherwise>
				TOTAL_SALES DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="selectProductByNo" resultMap="productResultMap">
		<include refid="selectProductSql"/>
		AND PRD_NO = #{no}
	</select>
	
	<select id="selectProductNewList" resultMap="productResultMap">
		SELECT PRD_NO,
			   NAME,
			   CATEGORY,
			   PRICE,
			   PRD_DESC,
			   IMAGE,
			   BRAND,
			   DISPLAY,
			   SALE,
			   STOCK,
			   RGSTR_DATE,
			   TOTAL_SALES,
			   VIEWS,
			   RATING,
			   STATUS,
			   WEIGHT
		FROM (
			<include refid="selectProductSql"/>
			ORDER BY RGSTR_DATE DESC 
		)
		WHERE ROWNUM BETWEEN 1 AND 16
	</select>
	
	<select id="selectProductBestList" resultMap="productResultMap">
		SELECT PRD_NO,
			   NAME,
			   CATEGORY,
			   PRICE,
			   PRD_DESC,
			   IMAGE,
			   BRAND,
			   DISPLAY,
			   SALE,
			   STOCK,
			   RGSTR_DATE,
			   TOTAL_SALES,
			   VIEWS,
			   RATING,
			   STATUS,
			   WEIGHT
		FROM (
			<include refid="selectProductSql"/>
			ORDER BY TOTAL_SALES DESC
		)
		WHERE ROWNUM BETWEEN 1 AND 16
	</select>
	
	<select id="selectProductListOrderByNo" resultMap="productResultMap">
		<include refid="selectProductSql"/>
		ORDER BY PRD_NO DESC
	</select>
	
	
	
	
	
</mapper>