<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
	
<mapper namespace="com.mealchelin.mvc.review.model.mapper.ReviewMapper">
	<sql id="reviewListSql">
		SELECT	REVIEW_NO,
				RATED,
				NAME,
				CONTENT,
				IMAGE,
				RGSTR_DATE,
				VIEWS,
				STATUS,
				USER_NO,
				PRD_NO
        FROM REVIEW
	</sql>

	<resultMap id="reviewListResultMap" type="Review">
		<id property="reviewNo" column="REVIEW_NO"/>
		<result property="rated" column="RATED"/>
		<result property="name" column="NAME"/>
		<result property="content" column="CONTENT"/>
		<result property="image" column="IMAGE"/>
		<result property="rgstrDate" column="RGSTR_DATE"/>
		<result property="views" column="VIEWS"/>
		<result property="status" column="STATUS"/>
		<result property="userNo" column="USER_NO"/>
		<result property="prdNo" column="PRD_NO"/>
	</resultMap>
	


	<!-- 게시글 등록 -->
	<insert id="insertReview" parameterType="Review"
		useGeneratedKeys="true" keyProperty="reviewNo" keyColumn="REVIEW_NO">
		INSERT INTO REVIEW (
			REVIEW_NO,
			RATED,
			NAME,
			CONTENT,
			RGSTR_DATE,
			IMAGE
		) VALUES(
			SEQ_REVIEW_NO.NEXTVAL,
			#{rated},
			#{name},
			#{content},
            SYSDATE,
			#{image}
		)
	</insert>

	<!-- 게시글 목록 조회(전체 목록) -->
	<select id="getReviewCount" resultType="_int">
		SELECT COUNT(*) FROM REVIEW WHERE STATUS='Y'
	</select>

	<select id="selectAll" resultMap="reviewListResultMap">
		<include refid="reviewListSql" />
		WHERE STATUS = 'Y'
        ORDER BY REVIEW_NO DESC
	</select>

	<!-- 리뷰 상세 보기 -->
	<select id="selectReviewByNo" parameterType="_int"
		resultMap="reviewListResultMap">
		SELECT REVIEW_NO,
		       RATED, 
		       NAME, 
		       CONTENT,
		       IMAGE,
		       RGSTR_DATE,
		       VIEWS,
		       STATUS,
		       USER_NO,
		       PRD_NO
		FROM REVIEW
		WHERE REVIEW_NO = #{reviewNo}
	</select>


</mapper>	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	